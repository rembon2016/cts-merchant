<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Halaman Transaksi — Pendapatan</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { primary: '#002F6C' },
          boxShadow: { soft: '0 8px 28px rgba(2,22,47,.08)' }
        }
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    html,body { font-family: Inter, ui-sans-serif, system-ui; }
    .safe-bottom { padding-bottom: calc(env(safe-area-inset-bottom) + 96px); }
    .safe-top { padding-top: calc(env(safe-area-inset-top) + 8px); }
  </style>
</head>
<body class="bg-gray-100 text-slate-900">
  <main class="max-w-sm mx-auto min-h-screen safe-bottom safe-top relative">

    <!-- Top bar -->
    <header class="px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-full bg-primary/10 text-primary grid place-items-center font-semibold">A</div>
        <div>
          <p class="text-slate-500 text-xs">Welcome back</p>
          <p class="font-semibold">Alex</p>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <button id="btn-search" class="p-2 rounded-xl bg-white shadow-soft" aria-label="search">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-slate-700" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m21 21-4.35-4.35M11 19a8 8 0 1 1 0-16 8 8 0 0 1 0 16Z"/></svg>
        </button>
        <button class="p-2 rounded-xl bg-white shadow-soft" aria-label="notif">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-slate-700" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 17h5l-1.4-1.4A2 2 0 0 1 18 14.2V11a6 6 0 1 0-12 0v3.2c0 .5-.2 1-.6 1.4L4 17h5"/></svg>
        </button>
      </div>
    </header>

    <!-- Income card (top) -->
    <section class="px-4">
      <div class="bg-white rounded-3xl p-4 shadow-soft">


        <!-- filter chips -->
        <div class="">
          <div class="flex items-center gap-2">
            <button data-filter="month" class="chip px-4 py-2 rounded-full bg-primary text-white text-sm font-medium">Month</button>
            <button data-filter="year" class="chip px-4 py-2 rounded-full bg-slate-100 text-slate-700 text-sm font-medium">Year</button>
            <button data-filter="range" class="chip px-4 py-2 rounded-full bg-slate-100 text-slate-700 text-sm font-medium">Range</button>
          </div>

          <!-- popovers -->
          <div id="popover-month" class="hidden mt-3 rounded-2xl border border-slate-200 bg-white shadow-soft p-3">
            <p class="text-xs text-slate-500 mb-2">Pilih Bulan</p>
            <div class="grid grid-cols-3 gap-2 text-sm">
              <button class="opt opt-month btn">Jan</button>
              <button class="opt opt-month btn">Feb</button>
              <button class="opt opt-month btn">Mar</button>
              <button class="opt opt-month btn">Apr</button>
              <button class="opt opt-month btn">Mei</button>
              <button class="opt opt-month btn">Jun</button>
              <button class="opt opt-month btn">Jul</button>
              <button class="opt opt-month btn">Agu</button>
              <button class="opt opt-month btn">Sep</button>
              <button class="opt opt-month btn">Okt</button>
              <button class="opt opt-month btn">Nov</button>
              <button class="opt opt-month btn">Des</button>
            </div>
          </div>

          <div id="popover-year" class="hidden mt-3 rounded-2xl border border-slate-200 bg-white shadow-soft p-3">
            <p class="text-xs text-slate-500 mb-2">Pilih Tahun</p>
            <div class="grid grid-cols-4 gap-2 text-sm">
              <button class="opt opt-year btn">2022</button>
              <button class="opt opt-year btn">2023</button>
              <button class="opt opt-year btn">2024</button>
              <button class="opt opt-year btn">2025</button>
              <button class="opt opt-year btn">2026</button>
            </div>
          </div>

          <div id="popover-range" class="hidden mt-3 rounded-2xl border border-slate-200 bg-white shadow-soft p-3">
            <p class="text-xs text-slate-500 mb-2">Pilih Rentang Tanggal</p>
            <div class="grid grid-cols-2 gap-2 text-sm">
              <label class="text-xs text-slate-600">Dari
                <input id="dateFrom" type="date" class="mt-1 w-full rounded-xl border-slate-200 focus:border-primary focus:ring-primary/30" />
              </label>
              <label class="text-xs text-slate-600">Sampai
                <input id="dateTo" type="date" class="mt-1 w-full rounded-xl border-slate-200 focus:border-primary focus:ring-primary/30" />
              </label>
            </div>
            <div class="mt-3 flex justify-end gap-2">
              <button id="rangeReset" class="px-3 py-1.5 rounded-xl text-sm bg-slate-100 text-slate-700">Reset</button>
              <button id="rangeApply" class="px-3 py-1.5 rounded-xl text-sm bg-primary text-white">Terapkan</button>
            </div>
          </div>

        </div>
      </div>
    </section>

    <!-- Search + List header -->
    <section class="px-4 mt-5">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-base font-semibold">Daftar Transaksi</h3>
        <div class="flex items-center gap-2">
          <input id="q" type="search" placeholder="Cari TXN / MID / desc" class="rounded-xl border border-slate-200 px-3 py-2 text-sm" />
        </div>
      </div>

      <!-- List -->
      <div id="txList" class="space-y-3">
        <!-- generated list -->
      </div>

      <div id="noResult" class="hidden py-6 text-center text-slate-500">Tidak ada transaksi sesuai filter</div>
    </section>

    <div class="h-28"></div>

    <!-- Bottom nav -->
   <nav class="fixed bottom-0 inset-x-0">
      <div class="max-w-sm mx-auto">
        <div class="mx-4 mb-4 rounded-3xl bg-white shadow-soft border border-slate-100 px-2 py-2 grid grid-cols-5 gap-1">
          <a href="./index.html" class="group flex flex-col items-center gap-1 py-1">
            <span class="size-9 grid place-items-center rounded-2xl bg-primary/10 text-primary">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M3 10.5 12 4l9 6.5V20a1 1 0 0 1-1 1h-4v-6H8v6H4a1 1 0 0 1-1-1v-9.5Z"/></svg>
            </span>
            <span class="text-[11px] font-medium text-primary">Home</span>
          </a>
          <a href="#" class="group flex flex-col items-center gap-1 py-1">
            <span class="size-9 grid place-items-center rounded-2xl bg-slate-100 text-slate-700">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M3 7h13m0 0-3-3m3 3-3 3M21 17H8m0 0 3-3m-3 3 3 3"/></svg>
            </span>
            <span class="text-[11px] text-slate-600">Transaksi</span>
          </a>
          <a href="./pos.html" class="group flex flex-col items-center gap-1 py-1">
            <span class="size-9 grid place-items-center rounded-2xl bg-slate-100 text-slate-700">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="size-5"><rect width="18" height="12" x="3" y="6" rx="2" ry="2" stroke-width="1.75"/><path d="M3 10h18" stroke-width="1.75"/></svg>
            </span>
            <span class="text-[11px] text-slate-600">POS</span>
          </a>
          <!--<a href="#" class="group flex flex-col items-center gap-1 py-1">-->
          <!--  <span class="size-9 grid place-items-center rounded-2xl bg-slate-100 text-slate-700">-->
          <!--    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M11 5 6 9H3v6h3l5 4V5Zm6.5 2.5a5 5 0 0 1 0 9M15 9a3 3 0 0 1 0 6"/></svg>-->
          <!--  </span>-->
          <!--  <span class="text-[11px] text-slate-600">Soundbox</span>-->
          <!--</a>-->
          <a href="./cs.html" class="group flex flex-col items-center gap-1 py-1">
            <span class="size-9 grid place-items-center rounded-2xl bg-slate-100 text-slate-700">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M3 11a9 9 0 1 1 18 0v6a3 3 0 0 1-3 3h-2v-6h5M6 20H5a2 2 0 0 1-2-2v-6h5v6H6Z"/></svg>
            </span>
            <span class="text-[11px] text-slate-600">CS</span>
          </a>
          <a href="./profile.html" class="group flex flex-col items-center gap-1 py-1">
            <span class="size-9 grid place-items-center rounded-2xl bg-slate-100 text-slate-700">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75" d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm7 8a7 7 0 0 0-14 0"/></svg>
            </span>
            <span class="text-[11px] text-slate-600">Profil</span>
          </a>
        </div>
      </div>
    </nav>

  </main>

  <script>
    // Sample transaction data (mirip screenshot DB)
    const transactions = [
      { id: 1, nomor_transaksi: 'TXN001', mid: 'MERCHANT001', nominal: 10000, pembayaran: 'CASH', tanggal_pembayaran: '2025-08-15T10:30:00', status: 'SUCCESS', description: 'Pembayaran tun', created_at: '2025-08-15T10:30:00', updated_at: '2025-08-22T14:30:44' },
      { id: 2, nomor_transaksi: 'TXN002', mid: 'MERCHANT002', nominal: 250000, pembayaran: 'CARD', tanggal_pembayaran: '2025-08-10T08:15:00', status: 'SUCCESS', description: 'Penjualan', created_at: '2025-08-10T08:15:00', updated_at: '2025-08-10T09:00:00' },
      { id: 3, nomor_transaksi: 'TXN003', mid: 'MERCHANT003', nominal: 15000, pembayaran: 'CASH', tanggal_pembayaran: '2025-07-12T12:00:00', status: 'FAILED', description: 'Refund', created_at: '2025-07-12T12:00:00', updated_at: '2025-07-12T12:05:00' },
      { id: 4, nomor_transaksi: 'TXN004', mid: 'MERCHANT001', nominal: 50000, pembayaran: 'TRANSFER', tanggal_pembayaran: '2024-12-23T16:10:00', status: 'SUCCESS', description: 'Transfer bank', created_at: '2024-12-23T16:10:00', updated_at: '2024-12-23T16:20:00' },
      { id: 5, nomor_transaksi: 'TXN005', mid: 'MERCHANT004', nominal: 75000, pembayaran: 'CASH', tanggal_pembayaran: '2025-08-20T09:05:00', status: 'PENDING', description: 'Pembayaran tun', created_at: '2025-08-20T09:05:00', updated_at: '2025-08-20T09:06:00' },
      { id: 6, nomor_transaksi: 'TXN006', mid: 'MERCHANT002', nominal: 120000, pembayaran: 'CARD', tanggal_pembayaran: '2025-06-03T14:30:00', status: 'SUCCESS', description: 'Penjualan online', created_at: '2025-06-03T14:30:00', updated_at: '2025-06-03T15:00:00' }
    ];

    // Helpers
    const $ = (s, el=document) => el.querySelector(s);
    const $$ = (s, el=document) => Array.from(el.querySelectorAll(s));
    const txList = $('#txList');
    const incomeAmountEl = $('#incomeAmount');
    const filterSummary = $('#filterSummary');

    // Format IDR
    const fmtIDR = (v) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(v);

    // Render transactions
    function renderTransactions(list){
      txList.innerHTML = '';
      if (!list.length) { $('#noResult').classList.remove('hidden'); return; } else { $('#noResult').classList.add('hidden'); }

      list.forEach(tx => {
        const card = document.createElement('article');
        card.className = 'bg-white rounded-2xl p-3 shadow-soft flex items-center justify-between';
        card.innerHTML = `
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 rounded-xl bg-primary/10 text-primary grid place-items-center text-sm font-bold">${tx.nomor_transaksi.slice(0,2)}</div>
            <div>
              <p class="font-medium">${tx.nomor_transaksi} • ${tx.mid}</p>
              <p class="text-xs text-slate-500">${formatDate(tx.tanggal_pembayaran)} • ${tx.pembayaran}</p>
              <p class="text-xs text-slate-500">${tx.description}</p>
            </div>
          </div>
          <div class="text-right">
            <p class="font-semibold ${tx.status==='SUCCESS' ? 'text-primary' : tx.status==='PENDING' ? 'text-amber-600' : 'text-red-600'}">${fmtIDR(tx.nominal)}</p>
            <p class="text-xs ${tx.status==='SUCCESS' ? 'text-green-600' : tx.status==='PENDING' ? 'text-amber-600' : 'text-red-600'}">${tx.status}</p>
          </div>
        `;

        // Expand details on click
        card.addEventListener('click', () => {
          showDetails(tx);
        });

        txList.appendChild(card);
      });
    }

    function formatDate(iso){
      const d = new Date(iso);
      if(isNaN(d)) return iso;
      const y = d.getFullYear(); const m = String(d.getMonth()+1).padStart(2,'0'); const day = String(d.getDate()).padStart(2,'0');
      const hh = String(d.getHours()).padStart(2,'0'); const mm = String(d.getMinutes()).padStart(2,'0');
      return `${y}-${m}-${day} ${hh}:${mm}`;
    }

    // Calculate income (simple: sum of SUCCESS amounts within current filters)
    function calcIncome(list){
      const sum = list.filter(t => t.status === 'SUCCESS').reduce((s,t) => s + (Number(t.nominal)||0), 0);
      incomeAmountEl.textContent = new Intl.NumberFormat('id-ID').format(sum);
    }

    // Filtering state
    let selectedMonth = null; // 1-12
    let selectedYear = null;
    let rangeFrom = null; let rangeTo = null;

    function applyFilters(){
      const q = ($('#q').value || '').trim().toLowerCase();
      let filtered = transactions.slice();

      if(selectedMonth){
        filtered = filtered.filter(t => new Date(t.tanggal_pembayaran).getMonth()+1 === selectedMonth);
      }
      if(selectedYear){
        filtered = filtered.filter(t => new Date(t.tanggal_pembayaran).getFullYear() === selectedYear);
      }
      if(rangeFrom && rangeTo){
        const from = new Date(rangeFrom);
        const to = new Date(rangeTo);
        to.setHours(23,59,59,999);
        filtered = filtered.filter(t => {
          const d = new Date(t.tanggal_pembayaran);
          return d >= from && d <= to;
        });
      }

      if(q){
        filtered = filtered.filter(t => (
          t.nomor_transaksi.toLowerCase().includes(q) || t.mid.toLowerCase().includes(q) || (t.description||'').toLowerCase().includes(q)
        ));
      }

      // sort desc by tanggal
      filtered.sort((a,b) => new Date(b.tanggal_pembayaran) - new Date(a.tanggal_pembayaran));

      renderTransactions(filtered);
      calcIncome(filtered);
    }

    // Details modal (simple alert-like panel)
    function showDetails(tx){
      const details = `\nNomor: ${tx.nomor_transaksi}\nMID: ${tx.mid}\nNominal: ${fmtIDR(tx.nominal)}\nPembayaran: ${tx.pembayaran}\nTanggal: ${formatDate(tx.tanggal_pembayaran)}\nStatus: ${tx.status}\nKeterangan: ${tx.description}\nCreated: ${tx.created_at}\nUpdated: ${tx.updated_at}`;
      alert(details);
    }

    // Popover toggles
    const chips = $$('.chip');
    const popMonth = $('#popover-month');
    const popYear = $('#popover-year');
    const popRange = $('#popover-range');

    function hidePopovers(){ popMonth.classList.add('hidden'); popYear.classList.add('hidden'); popRange.classList.add('hidden'); }

    chips.forEach(chip => {
      chip.addEventListener('click', (e) => {
        const key = chip.dataset.filter;
        // reset active classes
        chips.forEach(c => { c.classList.remove('bg-primary','text-white'); c.classList.add('bg-slate-100','text-slate-700'); });
        chip.classList.remove('bg-slate-100','text-slate-700'); chip.classList.add('bg-primary','text-white');
        hidePopovers();
        if(key === 'month') popMonth.classList.remove('hidden');
        if(key === 'year') popYear.classList.remove('hidden');
        if(key === 'range') popRange.classList.remove('hidden');
      });
    });

    // month selection
    $$('.opt-month').forEach((b,idx) => {
      b.addEventListener('click', () => {
        // map index to month number (1-based)
        const label = b.textContent;
        const monthMap = {Jan:1,Feb:2,Mar:3,Apr:4,Mei:5,Jun:6,Jul:7,Agu:8,Sep:9,Okt:10,Nov:11,Des:12};
        selectedMonth = monthMap[label] || (idx+1);
        filterSummary.textContent = `Bulan: ${label}`;
        hidePopovers();
        applyFilters();
      });
    });

    // year selection
    $$('.opt-year').forEach(b => {
      b.addEventListener('click', () => {
        selectedYear = Number(b.textContent);
        filterSummary.textContent = `Tahun: ${b.textContent}`;
        hidePopovers();
        applyFilters();
      });
    });

    // range apply/reset
    $('#rangeApply').addEventListener('click', () => {
      const f = $('#dateFrom').value; const t = $('#dateTo').value;
      if(!f || !t){ alert('Pilih kedua tanggal (dari & sampai)'); return; }
      rangeFrom = f; rangeTo = t;
      filterSummary.textContent = `Range: ${f} → ${t}`;
      hidePopovers();
      applyFilters();
    });
    $('#rangeReset').addEventListener('click', () => {
      rangeFrom=null; rangeTo=null; $('#dateFrom').value=''; $('#dateTo').value=''; filterSummary.textContent='Bulan ini'; hidePopovers(); applyFilters();
    });

    // search input
    $('#q').addEventListener('input', () => applyFilters());

    // click outside to hide popovers
    document.addEventListener('click', (e) => {
      const inside = e.target.closest('#popover-month, #popover-year, #popover-range, .chip');
      if (!inside) hidePopovers();
    });

    // init
    (function init(){
      renderTransactions(transactions.slice().sort((a,b)=> new Date(b.tanggal_pembayaran)-new Date(a.tanggal_pembayaran)));
      calcIncome(transactions);
    })();

    // Utility: add btn classes
    $$('.btn').forEach(b => b.classList.add('px-3','py-1.5','rounded-xl','bg-slate-100','hover:bg-primary/10','hover:text-primary'));
  </script>
</body>
</html>
